<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DramaBox Advanced API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0F172A; color: #CBD5E1; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        .btn-glow:hover { box-shadow: 0 0 15px rgba(99, 102, 241, 0.5); }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0F172A; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="border-b border-slate-700 bg-slate-900/50 sticky top-0 z-50 backdrop-blur-md">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 bg-indigo-500 rounded-lg flex items-center justify-center font-bold text-white">D</div>
                <h1 class="font-bold text-lg tracking-tight text-white">DramaBox <span class="text-indigo-400 font-mono text-xs ml-1">v2.0 PRO</span></h1>
            </div>
            <div class="flex items-center gap-3">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span class="text-xs font-mono text-emerald-400">SYSTEM ONLINE</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto px-4 py-8 max-w-6xl">
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Left Column: Controls -->
            <div class="lg:col-span-1 space-y-6">
                
                <div class="glass rounded-xl p-5">
                    <h2 class="text-white font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        Test Console
                    </h2>
                    
                    <div class="space-y-4">
                        <!-- Search Control -->
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-slate-500 uppercase">Search Query</label>
                            <div class="flex gap-2">
                                <input type="text" id="q-search" value="CEO" class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none transition-colors">
                                <button onclick="run('search')" class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-2 rounded text-sm font-medium btn-glow transition-all">GO</button>
                            </div>
                        </div>

                        <!-- Detail Control -->
                        <div class="space-y-2 pt-2 border-t border-slate-700">
                            <label class="text-xs font-bold text-slate-500 uppercase">Fetch Detail (ID)</label>
                            <div class="flex gap-2">
                                <input type="text" id="q-id" placeholder="Book ID" class="w-full bg-slate-800 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none transition-colors">
                                <button onclick="run('detail')" class="bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-2 rounded text-sm font-medium btn-glow transition-all">GO</button>
                            </div>
                        </div>

                        <!-- Stream Control -->
                        <div class="space-y-2 pt-2 border-t border-slate-700">
                            <label class="text-xs font-bold text-slate-500 uppercase">Stream (ID + Ep)</label>
                            <div class="flex gap-2">
                                <input type="text" id="q-stream-id" placeholder="ID" class="w-2/3 bg-slate-800 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none transition-colors">
                                <input type="number" id="q-stream-ep" value="1" class="w-1/3 bg-slate-800 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:border-indigo-500 focus:outline-none transition-colors">
                                <button onclick="run('stream')" class="bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-2 rounded text-sm font-medium btn-glow transition-all">â–¶</button>
                            </div>
                        </div>

                        <!-- Latest Control -->
                        <div class="pt-2 border-t border-slate-700">
                            <button onclick="run('latest')" class="w-full bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 rounded text-sm font-medium transition-colors">Fetch Latest Updates</button>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-xl p-5">
                    <h3 class="text-xs font-bold text-slate-500 uppercase mb-3">Endpoint Reference</h3>
                    <ul class="space-y-2 text-xs font-mono text-slate-400">
                        <li class="flex justify-between"><span class="text-indigo-400">GET</span> <span>/api/search?q=...</span></li>
                        <li class="flex justify-between"><span class="text-indigo-400">GET</span> <span>/api/detail?bookId=...</span></li>
                        <li class="flex justify-between"><span class="text-indigo-400">GET</span> <span>/api/stream?bookId=..&episode=..</span></li>
                        <li class="flex justify-between"><span class="text-indigo-400">GET</span> <span>/api/latest?page=1</span></li>
                    </ul>
                </div>

            </div>

            <!-- Right Column: Output -->
            <div class="lg:col-span-2">
                <div class="glass rounded-xl flex flex-col h-[600px] overflow-hidden relative">
                    <div class="bg-slate-800/80 px-4 py-2 flex justify-between items-center border-b border-slate-700">
                        <span class="text-xs font-mono text-slate-400 flex items-center gap-2">
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            RESPONSE TERMINAL
                        </span>
                        <div class="flex gap-2">
                            <button onclick="clearLogs()" class="text-xs text-slate-500 hover:text-white transition-colors">Clear</button>
                            <button onclick="copyLogs()" class="text-xs text-indigo-400 hover:text-indigo-300 transition-colors">Copy</button>
                        </div>
                    </div>
                    <div class="flex-1 bg-[#0B101E] p-4 overflow-auto font-mono text-xs relative" id="terminal-container">
                        <div id="output" class="text-slate-300 whitespace-pre-wrap break-all">
                            <span class="text-slate-500">// Waiting for input...</span>
                        </div>
                    </div>
                    <!-- Status Bar -->
                    <div class="bg-slate-900 border-t border-slate-800 px-4 py-1 flex justify-between items-center text-[10px] text-slate-500 font-mono">
                        <span id="status-method">METHOD: IDLE</span>
                        <span id="status-time">TIME: 0ms</span>
                        <span id="status-code">STATUS: -</span>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        const output = document.getElementById('output');
        const statusMethod = document.getElementById('status-method');
        const statusTime = document.getElementById('status-time');
        const statusCode = document.getElementById('status-code');

        function log(data, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            let colorClass = 'text-slate-300';
            if (type === 'error') colorClass = 'text-red-400';
            if (type === 'success') colorClass = 'text-emerald-400';
            if (type === 'warn') colorClass = 'text-amber-400';

            const content = typeof data === 'object' ? JSON.stringify(data, null, 2) : data;
            output.innerHTML = `<div class="mb-4 ${colorClass}"><span class="opacity-50">[${timestamp}]</span> ${content}</div>`;
        }

        async function run(type) {
            output.innerHTML = '<span class="text-indigo-400 animate-pulse">Processing request...</span>';
            const startTime = performance.now();
            let url = '';

            try {
                if (type === 'search') {
                    const q = document.getElementById('q-search').value;
                    url = `/api/search?q=${encodeURIComponent(q)}`;
                } else if (type === 'detail') {
                    const id = document.getElementById('q-id').value;
                    if(!id) throw new Error("ID required");
                    url = `/api/detail?bookId=${id}`;
                } else if (type === 'stream') {
                    const id = document.getElementById('q-stream-id').value;
                    const ep = document.getElementById('q-stream-ep').value;
                    if(!id) throw new Error("ID and Episode required");
                    url = `/api/stream?bookId=${id}&episode=${ep}`;
                } else if (type === 'latest') {
                    url = `/api/latest`;
                }

                statusMethod.textContent = `METHOD: GET ${type.toUpperCase()}`;
                
                const res = await fetch(url);
                const data = await res.json();
                
                const endTime = performance.now();
                statusTime.textContent = `TIME: ${(endTime - startTime).toFixed(2)}ms`;
                statusCode.textContent = `STATUS: ${res.status}`;
                statusCode.className = res.ok ? 'text-emerald-500' : 'text-red-500';

                log(data, res.ok ? 'success' : 'error');

                // Auto-fill IDs if search returns data
                if (type === 'search' && data.data && data.data.length > 0 && data.data[0].bookId) {
                    document.getElementById('q-id').value = data.data[0].bookId;
                    document.getElementById('q-stream-id').value = data.data[0].bookId;
                }

            } catch (err) {
                log(err.message, 'error');
            }
        }

        function clearLogs() {
            output.innerHTML = '<span class="text-slate-500">// Logs cleared.</span>';
        }
        
        function copyLogs() {
            navigator.clipboard.writeText(output.innerText);
            alert('Logs copied!');
        }
    </script>
</body>
</html>


